<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>INTROSPECT</title>

  <style>
    :root{
      --bg:#07080a; --fg:#e9edf2;
      --muted:rgba(233,237,242,.72);
      --faint:rgba(233,237,242,.18);
      --danger:rgba(255,140,140,.95);
      --ok:rgba(120,255,180,.65);
    }

    html,body{
      height:100%;margin:0;background:var(--bg);color:var(--fg);overflow:hidden;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
    }

    .wrap{height:100%;display:grid;place-items:center}

    .stage{
      position:relative;width:min(92vw,900px);aspect-ratio:16/9;border-radius:18px;
      overflow:hidden;
      background:
        radial-gradient(1200px 600px at 50% 40%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), transparent 35%);
      box-shadow:
        0 20px 80px rgba(0,0,0,.65),
        inset 0 0 0 1px rgba(255,255,255,.08);
    }

    video,canvas{
      position:absolute;inset:0;width:100%;height:100%;
      object-fit:cover;transform:scaleX(-1);
    }

    .scanlines{
      position:absolute;inset:0;pointer-events:none;
      background:repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,0),
        rgba(0,0,0,0) 2px,
        rgba(0,0,0,.18) 3px);
      opacity:.55;
    }

    .vignette{
      position:absolute;inset:0;pointer-events:none;
      background:radial-gradient(circle at 50% 45%,
        rgba(0,0,0,.05) 0%,
        rgba(0,0,0,.25) 55%,
        rgba(0,0,0,.70) 100%);
    }

    .grain{
      position:absolute;inset:-20%;pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      opacity:.22;
      animation:drift 6s linear infinite;
    }

    @keyframes drift{
      0%{transform:translate(-2%,-1%)}
      50%{transform:translate(1%,2%)}
      100%{transform:translate(-2%,-1%)}
    }

    .hud{
      position:absolute;inset:0;
      display:grid;grid-template-rows:auto 1fr auto;
      padding:18px;pointer-events:none;
    }

    .topline{
      display:flex;justify-content:space-between;
      text-transform:uppercase;font-size:12px;
      letter-spacing:.12em;color:var(--faint);
    }

    .centerPrompt{
      align-self:center;justify-self:center;
      background:rgba(0,0,0,.25);
      padding:22px 20px;border-radius:16px;
      text-align:center;max-width:620px;
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
      pointer-events:auto;
    }

    .title{
      margin:0 0 12px;
      font-size:clamp(18px,3vw,26px);
      letter-spacing:.14em;text-transform:uppercase;
    }

    .sub{color:var(--muted);font-size:14px;margin-bottom:16px}

    .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

    button{
      border:0;border-radius:999px;
      padding:10px 14px;
      background:rgba(233,237,242,.12);
      color:#fff;font-size:12px;
      letter-spacing:.1em;text-transform:uppercase;
      cursor:pointer;
    }

    button[disabled]{opacity:.35}

    .hintline{margin-top:12px;font-size:12px;color:rgba(233,237,242,.6)}

    .bottom{
      display:flex;justify-content:space-between;
      font-size:11px;text-transform:uppercase;
      color:var(--faint);
    }

    .statusDot{
      width:8px;height:8px;border-radius:50%;
      background:rgba(255,255,255,.2);
      display:inline-block;margin-right:6px;
    }

    .statusDot.on{background:var(--ok)}

    .error{
      margin-top:10px;font-size:12px;
      color:var(--danger);display:none;
    }

    .reveal{
      display:none;margin-top:14px;
      padding:12px;border-radius:14px;
      background:rgba(0,0,0,.25);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
    }

    .reveal p{font-size:13px;color:rgba(233,237,242,.8)}

    .reveal a{
      display:inline-block;margin-top:8px;
      padding:10px 14px;border-radius:999px;
      background:rgba(233,237,242,.15);
      color:#fff;text-decoration:none;
      letter-spacing:.1em;font-size:12px;
    }

    @media(max-width:520px){
      .stage{aspect-ratio:9/16}
    }
  </style>
</head>

<body>

<div class="wrap">

  <div class="stage">

    <video id="vid" autoplay muted playsinline></video>
    <canvas id="fx"></canvas>

    <div class="scanlines"></div>
    <div class="grain"></div>
    <div class="vignette"></div>

    <div class="hud">

      <div class="topline">
        <div>INTROSPECT</div>
        <div id="clock">—</div>
      </div>

      <div class="centerPrompt">

        <h1 class="title">Look inward.</h1>

        <p class="sub">
          The gate opens in reflection.
        </p>

        <div class="row">
          <button id="btnCamera">Enable Mirror</button>
          <button id="btnTry" disabled>Try Again</button>
          <button id="btnStop" disabled>Stop</button>
        </div>

        <div class="hintline" id="hint">
          Hold still. The system is watching.
        </div>

        <div class="error" id="err"></div>

        <div class="reveal" id="reveal">
          <p>You are here. You are the witness.</p>
          <a href="https://www.photonisdead.com/" target="_blank">
            Unlock
          </a>
        </div>

      </div>

      <div class="bottom">
        <div>
          <span class="statusDot" id="dot"></span>
          <span id="status">Mirror idle</span>
        </div>
        <div id="tech">—</div>
      </div>

    </div>
  </div>
</div>


<script>

const vid = document.getElementById("vid");
const fx = document.getElementById("fx");
const ctx = fx.getContext("2d");

const btnCamera = document.getElementById("btnCamera");
const btnTry = document.getElementById("btnTry");
const btnStop = document.getElementById("btnStop");

const statusEl = document.getElementById("status");
const dot = document.getElementById("dot");
const errEl = document.getElementById("err");

const reveal = document.getElementById("reveal");
const hint = document.getElementById("hint");
const clock = document.getElementById("clock");

let stream = null;
let raf = null;

let presence = 0;
let lastFrame = null;
let active = false;


setInterval(()=>{
  const d=new Date();
  clock.textContent =
    d.getHours().toString().padStart(2,"0")+":"+
    d.getMinutes().toString().padStart(2,"0")+":"+
    d.getSeconds().toString().padStart(2,"0");
},300);


function setStatus(t,on=false){
  statusEl.textContent=t;
  dot.classList.toggle("on",on);
}

function showError(t){
  errEl.style.display="block";
  errEl.textContent=t;
}

function clearError(){
  errEl.style.display="none";
}


function size(){
  const r=fx.getBoundingClientRect();
  const dpr=Math.min(window.devicePixelRatio||1,2);
  fx.width=r.width*dpr;
  fx.height=r.height*dpr;
}

window.addEventListener("resize",size);


async function startCam(){

  clearError();
  reveal.style.display="none";
  presence=0;
  lastFrame=null;
  active=false;

  btnTry.disabled=true;

  try{

    stream = await navigator.mediaDevices.getUserMedia({
      video:{facingMode:"user"},audio:false
    });

    vid.srcObject=stream;
    await vid.play();

    size();

    btnStop.disabled=false;
    setStatus("Mirror active",true);

    active=true;
    hint.textContent="Hold still. Become present.";

    loop();

  }catch(e){

    stream=null;
    btnTry.disabled=false;

    setStatus("Mirror denied");
    showError("Reflection required. Try again.");
    hint.textContent="The answer is not outside.";

  }

}


function stopCam(){

  if(raf) cancelAnimationFrame(raf);

  if(stream){
    stream.getTracks().forEach(t=>t.stop());
  }

  stream=null;
  active=false;

  presence=0;
  lastFrame=null;

  btnStop.disabled=true;
  btnTry.disabled=false;

  setStatus("Mirror stopped");
  showError("The loop resets.");
  hint.textContent="Look inward.";

}


function clamp(v,a,b){
  return Math.max(a,Math.min(b,v));
}


function draw(){

  const w=fx.width,h=fx.height;

  ctx.drawImage(vid,0,0,w,h);

  const img=ctx.getImageData(0,0,w,h);
  const d=img.data;

  for(let i=0;i<d.length;i+=4){

    let y=.2126*d[i]+.7152*d[i+1]+.0722*d[i+2];
    y=(y-128)*1.12+128;

    d[i]=clamp(y*.98,0,255);
    d[i+1]=clamp(y,0,255);
    d[i+2]=clamp(y*1.04,0,255);

  }

  ctx.putImageData(img,0,0);

  if(active){

    ctx.globalAlpha=.1+.15*(presence/100);
    ctx.fillStyle="#fff";
    ctx.font=`${w*.03}px system-ui`;
    ctx.textAlign="center";

    ctx.fillText("YOU ARE WATCHING YOURSELF",w/2,h*.6);
    ctx.fillText("…BE STILL",w/2,h*.68);

    ctx.globalAlpha=1;

  }

}


function analyze(){

  const w=fx.width,h=fx.height;

  try{

    const f=ctx.getImageData(0,0,w,h);

    if(lastFrame){

      let diff=0;

      for(let i=0;i<f.data.length;i+=256){
        diff+=Math.abs(f.data[i]-lastFrame.data[i]);
      }

      const still=clamp(1-diff/90000,0,1);

      presence=clamp(
        presence+still*1.8-(1-still)*2,
        0,120
      );

    }

    lastFrame=f;

  }catch(e){}

}


function loop(){

  if(!stream) return;

  draw();
  analyze();

  if(active && presence>85){

    active=false;

    reveal.style.display="block";
    setStatus("Gate open",true);

    hint.textContent="The system recognizes you.";

  }

  raf=requestAnimationFrame(loop);

}


btnCamera.onclick=startCam;
btnTry.onclick=startCam;
btnStop.onclick=stopCam;

document.addEventListener("visibilitychange",()=>{
  if(document.hidden) stopCam();
});

</script>

</body>
</html>
